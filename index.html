<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta name="description" content="ì£¼ë‹ˆì–´ ìŠ¤ì¿¼ì‹œ ì„ ìˆ˜ë¥¼ ìœ„í•œ ê³¼í•™ì ì´ê³  ì•ˆì „í•œ ìŠ¤íŠ¸ë ˆì¹­ ì „ë¬¸ ì•±">
    <meta name="theme-color" content="#10b981">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ìŠ¤ì¿¼ì‹œ ìŠ¤íŠ¸ë ˆì¹­">
    
    <title>ì£¼ë‹ˆì–´ ìŠ¤ì¿¼ì‹œ ìŠ¤íŠ¸ë ˆì¹­ í”„ë¡œ</title>
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIj4KICA8cmVjdCB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgZmlsbD0iIzEwYjk4MSIgcng9IjEwIiB5PSIxMCIgd2lkdGg9IjE3MiIgaGVpZ2h0PSIxNzIiLz4KICA8dGV4dCB4PSI5NiIgeT0iMTEwIiBmb250LXNpemU9IjcwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiPuyCpO2KuOyWtuyngDwvdGV4dD4KPC9zdmc+">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIj4KICA8cmVjdCB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgZmlsbD0iIzEwYjk4MSIgcng9IjEwIiB5PSIxMCIgd2lkdGg9IjE3MiIgaGVpZ2h0PSIxNzIiLz4KICA8dGV4dCB4PSI5NiIgeT0iMTEwIiBmb250LXNpemU9IjcwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiPuyCpO2KuOyWtuyngDwvdGV4dD4KPC9zdmc+">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIuyjvOuLiOyWtCDsiqTsv7Dsovwg7Iqk7Yq47Ja27LmtIO2UhOuhnSIsCiAgInNob3J0X25hbWUiOiAi7Iqk7Yq47Ja2IOyVsSIsCiAgImRlc2NyaXB0aW9uIjogIuyjvOuLiOyWtCDsiqTsv7Dsovwg7ISg7IiY66W47J2EIOychO2VnCDqs7XtlZnsoIHsnbTqs6Ag7JWI7KCE7ZWY6rOgIOyViOyghO2VnCDsiqTtirjslrbs5Kcg7KCV66y4IiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmZmZmZmYiLAogICJ0aGVtZV9jb2xvciI6ICIjMTBiOTgxIiwKICAib3JpZW50YXRpb24iOiAicG9ydHJhaXQiLAogICJjYXRlZ29yaWVzIjogWyJmaXRuZXNzIiwgInNwb3J0cyIsICJoZWFsdGgiXSwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0l4T1RJaUlHaGxhV2RvZEQwaU1Ua3lJajRLSUNBOGNtVmpkQ0IzYVdSMGFEMGlNVGt5SWlCb1pXbG5hSFE5SWpFNU1pSWdabWxzYkQwaUl6RXdZams0TVNJZ2NuZzlJakV3SWlCNVBTSXhNQ0lnZDJsa2RHZzlJakUzTWlJZ2FHVnBaMmgwUFNJeE56SWlMejRLSUNBOGRHVjRkQ0I0UFNJNU5pSWdlVDBpTVRFd0lpQm1iMjUwTFhOcGVtVTlJamN3SWlCbWFXeHNQU0ozYUdsMFpTSWdkR1Y0ZEMxaGJtTm9iM0k5SW0xcFpHUnNaU0lnWm05dWRDMW1ZVzFwYkhrcUluTmhibk10YzJWeWFXWWlQdWlDcE8yS3VPeVd0dXluZ0R3dmRHVjRkRDRLUEM5emRtYysrQT09IiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBIM1ZuSUhodGJHeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0kxTVRJaUlHaGxhV2RvZEQwaU5URXlJajRLSUNBOGNtVmpkQ0IzYVdSMGFEMGlOVEV5SWlCb1pXbG5hSFE5SWpVeE1pSWdabWxzYkQwaUl6RXdZams0TVNJZ2NuZzlJakl3SWlCNVBTSXlNQ0lnZDJsa2RHZzlJalEzTWlJZ2FHVnBaMmgwUFNJME56SWlMejRLSUNBOGRHVjRkQ0I0UFNJeU5UWWlJSGs5SWpJM01pSWdabTl1ZEMxemFYcGxQU0l4TkRBaUlHWnBiR3c5SW5kb2FYUmxJaUIwWlhoMExXRnVZMmh2Y2owaWJXbGtaR3hsU1NJZ1ptOXVkQzFtWVcxcGJIa3FJWE5oYm5NdGMyVnlhV1lpUHVpQ3BPMkt1T3lXdHV5bmdEd3ZkR1Y0ZEQ0S1BDOXpkbWMrIiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ==">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"></noscript>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #ecfdf5 100%);
            color: #1f2937;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            /* í„°ì¹˜ ìµœì í™” */
            touch-action: manipulation;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* í„°ì¹˜ ê°€ëŠ¥í•œ ìš”ì†Œë“¤ì€ í„°ì¹˜ í—ˆìš© */
        button, select, input, [data-action], .clickable {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }
        
        .app {
            min-height: 100vh;
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding-top: max(16px, env(safe-area-inset-top));
            padding-bottom: max(16px, env(safe-area-inset-bottom));
            padding-left: max(16px, env(safe-area-inset-left));
            padding-right: max(16px, env(safe-area-inset-right));
        }
        
        .container {
            width: 100%;
            max-width: 420px;
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            overflow: hidden;
            position: relative;
        }
        
        .header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            padding: 24px;
            text-align: center;
            color: white;
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .content {
            padding: 24px;
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            text-align: center;
            position: relative;
            overflow: hidden;
            /* í„°ì¹˜ ìµœì í™” */
            touch-action: manipulation;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
            outline: none;
            /* ìµœì†Œ í„°ì¹˜ ì˜ì—­ ë³´ì¥ */
            min-height: 48px;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 14px 0 rgba(16, 185, 129, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 14px 0 rgba(59, 130, 246, 0.3);
        }
        
        .btn-outline {
            background: white;
            color: #374151;
            border: 2px solid #e5e7eb;
        }
        
        .btn-outline:hover, .btn-outline:active {
            border-color: #10b981;
            color: #10b981;
            background: #f0fdf4;
        }
        
        .btn:disabled {
            background: #f3f4f6 !important;
            color: #9ca3af !important;
            cursor: not-allowed !important;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .grid {
            display: grid;
            gap: 16px;
        }
        
        .grid-2 {
            grid-template-columns: 1fr 1fr;
        }
        
        .timer {
            text-align: center;
            margin: 32px 0;
        }
        
        .timer-display {
            font-size: 64px;
            font-weight: 700;
            color: #1f2937;
            line-height: 1;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .timer.running .timer-display {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .exercise-card {
            background: #f8fafc;
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
            border: 2px solid #e2e8f0;
        }
        
        .exercise-title {
            font-size: 20px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 12px;
        }
        
        .exercise-info {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 16px;
        }
        
        .exercise-instructions {
            font-size: 14px;
            line-height: 1.6;
            color: #374151;
            margin-bottom: 16px;
        }
        
        .safety-tip {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 12px;
            padding: 12px;
            font-size: 13px;
            color: #92400e;
        }
        
        .safety-tip::before {
            content: "âš ï¸ ";
            font-weight: 700;
        }
        
        .progress-bar {
            background: #e5e7eb;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 16px 0;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .controls {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        
        .btn-control {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            /* í„°ì¹˜ ìµœì í™” */
            touch-action: manipulation;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
            min-height: 48px;
            outline: none;
        }
        
        .btn-play {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            flex: 2;
        }
        
        .btn-skip {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .btn-skip:hover, .btn-skip:active {
            background: #e5e7eb;
        }
        
        .profile-setup {
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-select, .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
            background: white;
            transition: border-color 0.2s ease;
            /* í„°ì¹˜ ìµœì í™” */
            touch-action: manipulation;
            outline: none;
            min-height: 48px;
        }
        
        .form-select:focus, .form-input:focus {
            border-color: #10b981;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
            /* í„°ì¹˜ ìµœì í™” */
            touch-action: manipulation;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
            min-height: 48px;
            outline: none;
        }
        
        .checkbox-item:hover, .checkbox-item:active {
            border-color: #d1d5db;
        }
        
        .checkbox-item.selected {
            border-color: #10b981;
            background: #f0fdf4;
        }
        
        .checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid #d1d5db;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        
        .checkbox.checked {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }
        
        .completion-screen {
            text-align: center;
            padding: 40px 24px;
        }
        
        .completion-icon {
            font-size: 64px;
            margin-bottom: 24px;
            display: block;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin: 24px 0;
        }
        
        .stat-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #e2e8f0;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #10b981;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .education-content {
            max-height: 60vh;
            overflow-y: auto;
            padding-right: 8px;
        }
        
        .education-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .education-card h3 {
            font-size: 16px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 8px;
        }
        
        .education-card p, .education-card ul {
            font-size: 14px;
            color: #4b5563;
            line-height: 1.5;
        }
        
        .education-card ul {
            list-style: none;
            padding-left: 0;
        }
        
        .education-card li {
            padding: 4px 0;
        }
        
        .education-card li::before {
            content: "â€¢ ";
            color: #10b981;
            font-weight: bold;
        }
        
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 16px;
            border-radius: 12px;
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .install-prompt button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            touch-action: manipulation;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
            min-height: 36px;
        }
        
        .offline-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #f59e0b;
            color: white;
            padding: 8px;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
            z-index: 1000;
            display: none;
        }
        
        .hidden {
            display: none !important;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* í„°ì¹˜ í”¼ë“œë°± ê°œì„  */
        .btn:active, .btn-control:active, .checkbox-item:active {
            transform: scale(0.96);
        }
        
        /* Mobile optimizations */
        @media (max-width: 480px) {
            .app {
                padding: 8px;
            }
            
            .timer-display {
                font-size: 48px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .content {
                padding: 16px;
            }
            
            .btn {
                font-size: 15px;
                padding: 14px;
            }
            
            .btn-control {
                padding: 10px;
                font-size: 14px;
            }
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            }
            
            .container {
                background: #374151;
                color: white;
            }
            
            .exercise-card {
                background: #4b5563;
                border-color: #6b7280;
            }
            
            .form-select, .form-input {
                background: #4b5563;
                border-color: #6b7280;
                color: white;
            }
            
            .checkbox-item {
                background: #4b5563;
                border-color: #6b7280;
            }
        }
    </style>
</head>
<body>
    <div id="offlineBanner" class="offline-banner">
        ğŸ”„ ì˜¤í”„ë¼ì¸ ëª¨ë“œ - ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”
    </div>
    
    <div class="app">
        <div class="container">
            <div id="app-content">
                <!-- Content will be rendered here -->
            </div>
        </div>
    </div>
    
    <div id="installPrompt" class="install-prompt">
        <div>
            <strong>ğŸ“± ìŠ¤ë§ˆíŠ¸í°ì— ì„¤ì¹˜í•˜ê¸°</strong>
            <p style="font-size: 12px; margin: 4px 0 0 0;">ì˜¤í”„ë¼ì¸ì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥</p>
        </div>
        <button onclick="installApp()">ì„¤ì¹˜</button>
        <button onclick="dismissInstall()" style="background: transparent;">ë‚˜ì¤‘ì—</button>
    </div>

    <script>
        // App State Management
        class StretchingApp {
            constructor() {
                this.state = {
                    currentScreen: 'welcome',
                    userProfile: this.loadProfile(),
                    currentRoutine: null,
                    currentPhase: 0,
                    currentExercise: 0,
                    timeRemaining: 0,
                    isRunning: false,
                    sessionProgress: this.loadProgress(),
                    timerInterval: null
                };
                
                this.routines = {
                    warmup: {
                        id: 'warmup',
                        title: 'ê²½ê¸° ì „ ì›œì—… (ë™ì  ìŠ¤íŠ¸ë ˆì¹­)',
                        description: 'ìŠ¤ì¿¼ì‹œ ê²½ê¸°ë¥¼ ìœ„í•œ 3ë‹¨ê³„ ê³¼í•™ì  ì¤€ë¹„ìš´ë™',
                        color: '#10b981',
                        totalTime: 18, // minutes
                        phases: [
                            {
                                name: '1ë‹¨ê³„: ì¼ë°˜ì  í™œì„±í™”',
                                description: 'ì‹¬ë°•ìˆ˜ ìƒìŠ¹ ë° ì²´ì˜¨ ì¡°ì ˆ',
                                exercises: [
                                    {
                                        name: 'ê°€ë²¼ìš´ ì¡°ê¹… & ì í•‘ì­',
                                        duration: 180,
                                        instructions: 'ì½”íŠ¸ ì£¼ë³€ì„ ê°€ë³ê²Œ ì¡°ê¹…í•˜ê±°ë‚˜ ì œìë¦¬ì—ì„œ ì í•‘ì­ì„ ì‹¤ì‹œí•˜ì—¬ ëª¸ì„ ì˜ˆì—´í•˜ì„¸ìš”. ìˆ¨ì´ ì•½ê°„ ì°° ì •ë„ì˜ ê°•ë„ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.',
                                        targetMuscles: 'ì „ì‹ , ì‹¬íì§€êµ¬ë ¥',
                                        safetyTip: 'ê°‘ì‘ìŠ¤ëŸ¬ìš´ ì›€ì§ì„ì€ í”¼í•˜ê³  ì ì§„ì ìœ¼ë¡œ ê°•ë„ë¥¼ ë†’ì´ì„¸ìš”.'
                                    },
                                    {
                                        name: 'íŒ” ëŒë¦¬ê¸° & ì–´ê¹¨ í’€ê¸°',
                                        duration: 60,
                                        instructions: 'ì•ìœ¼ë¡œ, ë’¤ë¡œ í¬ê²Œ ì›ì„ ê·¸ë¦¬ë©° ì–´ê¹¨ë¥¼ í’€ì–´ì¤ë‹ˆë‹¤. ì‘ì€ ì›ì—ì„œ ì‹œì‘í•˜ì—¬ ì ì°¨ í¬ê²Œ ë§Œë“œì„¸ìš”.',
                                        targetMuscles: 'ì–´ê¹¨, ìƒì²´',
                                        safetyTip: 'ì–´ê¹¨ì— í†µì¦ì´ ìˆë‹¤ë©´ ì‘ì€ ë²”ìœ„ì—ì„œ ì‹œì‘í•˜ì„¸ìš”.'
                                    }
                                ]
                            },
                            {
                                name: '2ë‹¨ê³„: ì „ì‹  ê°€ë™ì„± í™•ë³´',
                                description: 'ê´€ì ˆ ê°€ë™ë²”ìœ„ ì¦ëŒ€ ë° ê·¼ìœ¡ í™œì„±í™”',
                                exercises: [
                                    {
                                        name: 'ëª¸í†µ í’ì°¨ ëŒë¦¬ê¸°',
                                        duration: 60,
                                        instructions: 'ì–‘ ë‹¤ë¦¬ë¥¼ ì–´ê¹¨ë„ˆë¹„ë¡œ ë²Œë¦¬ê³  ì„  í›„, í—ˆë¦¬ë¥¼ ìˆ™ì—¬ ì™¼íŒ”ì„ ì˜¤ë¥¸ë°œ ìª½ìœ¼ë¡œ, ì˜¤ë¥¸íŒ”ì€ í•˜ëŠ˜ë¡œ ë»—ì–´ êµì°¨ ë™ì‘ì„ 20-30íšŒ ë°˜ë³µí•©ë‹ˆë‹¤.',
                                        targetMuscles: 'ëª¸í†µ, ë“±, í—ˆë¦¬',
                                        safetyTip: 'ê³¼ë„í•œ ë°˜ë™ì€ ê¸ˆì§€. ë¶€ë“œëŸ½ê³  í†µì œëœ ì›€ì§ì„ìœ¼ë¡œ ì§„í–‰í•˜ì„¸ìš”.',
                                        reps: '20-30íšŒ'
                                    },
                                    {
                                        name: 'ë‹¤ë¦¬ ì•ë’¤ & ì¢Œìš° í”ë“¤ê¸°',
                                        duration: 120,
                                        instructions: 'ë²½ì´ë‚˜ íŒŒíŠ¸ë„ˆë¥¼ ì¡ê³  ê· í˜•ì„ ìœ ì§€í•˜ë©° í•œìª½ ë‹¤ë¦¬ë¥¼ ì•ë’¤ë¡œ, ê·¸ë‹¤ìŒ ì¢Œìš°ë¡œ ë¶€ë“œëŸ½ê²Œ í”ë“­ë‹ˆë‹¤.',
                                        targetMuscles: 'í–„ìŠ¤íŠ¸ë§, ì—‰ë©ì´ êµ´ê³¡ê·¼',
                                        safetyTip: 'ê· í˜•ì„ ìƒì§€ ì•Šë„ë¡ ì§€ì§€ëŒ€ë¥¼ í™œìš©í•˜ì„¸ìš”.'
                                    },
                                    {
                                        name: 'í•˜ì´ ë‹ˆ & ë²„íŠ¸ í‚¥',
                                        duration: 60,
                                        instructions: 'ì œìë¦¬ì—ì„œ ê°€ë³ê²Œ ë›°ë©´ì„œ ë¬´ë¦ì„ ê°€ìŠ´ ë†’ì´ê¹Œì§€ ì˜¬ë¦¬ëŠ” í•˜ì´ ë‹ˆì™€ ë°œë’¤ê¿ˆì¹˜ë¥¼ ì—‰ë©ì´ë¡œ ì°¨ëŠ” ë²„íŠ¸ í‚¥ì„ ë²ˆê°ˆì•„ ì§„í–‰í•©ë‹ˆë‹¤.',
                                        targetMuscles: 'ëŒ€í‡´ì‚¬ë‘ê·¼, í–„ìŠ¤íŠ¸ë§, ë‘”ê·¼',
                                        safetyTip: 'ì°©ì§€ ì‹œ ë¬´ë¦ì— ë¬´ë¦¬ê°€ ê°€ì§€ ì•Šë„ë¡ ë¶€ë“œëŸ½ê²Œ ì°©ì§€í•˜ì„¸ìš”.'
                                    },
                                    {
                                        name: 'ê³ ê´€ì ˆ íšŒì „ ìš´ë™',
                                        duration: 90,
                                        instructions: 'ë¬´ë¦ì„ 90ë„ë¡œ ë“¤ì–´ì˜¬ë ¤ ë°”ê¹¥ ë°©í–¥ìœ¼ë¡œ ì›ì„ ê·¸ë¦¬ë“¯ íšŒì „ì‹œí‚µë‹ˆë‹¤. ì—‰ë©ì´ ê´€ì ˆì˜ ê°€ë™ì„±ì„ ë†’ì…ë‹ˆë‹¤.',
                                        targetMuscles: 'ê³ ê´€ì ˆ, ì—‰ë©ì´',
                                        safetyTip: 'í†µì¦ì´ ëŠê»´ì§€ë©´ íšŒì „ ë²”ìœ„ë¥¼ ì¤„ì´ì„¸ìš”.'
                                    }
                                ]
                            },
                            {
                                name: '3ë‹¨ê³„: ìŠ¤ì¿¼ì‹œ íŠ¹ì • ë™ì‘ í™œì„±í™”',
                                description: 'ì‹¤ì œ ê²½ê¸° ë™ì‘ ëª¨ë°© ë° ê·¼ì‹ ê²½ í™œì„±í™”',
                                exercises: [
                                    {
                                        name: 'ê±·ëŠ” ëŸ°ì§€ & íšŒì „ ë™ì‘',
                                        duration: 120,
                                        instructions: 'ì•ìœ¼ë¡œ í•œ ë°œì„ í¬ê²Œ ë‚´ë”›ì–´ ëŸ°ì§€ ìì„¸ë¥¼ ì·¨í•˜ê³ , ì•ìª½ ë‹¤ë¦¬ ìœ„ë¡œ ìƒì²´ë¥¼ ë¹„í‹‰ë‹ˆë‹¤. ê° ë‹¤ë¦¬ë‹¹ 10íšŒì”© ë°˜ë³µí•©ë‹ˆë‹¤.',
                                        targetMuscles: 'ëŒ€í‡´ì‚¬ë‘ê·¼, ë‘”ê·¼, ì—‰ë©ì´ êµ´ê³¡ê·¼, ì½”ì–´',
                                        safetyTip: 'ë¬´ë¦ì´ ë°œëì„ ë„˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì„¸ìš”.'
                                    },
                                    {
                                        name: 'ê³ ìŠ¤íŒ… (Ghosting) í›ˆë ¨',
                                        duration: 300,
                                        instructions: 'ë¼ì¼“ì„ ë“¤ê³  ì½”íŠ¸ì˜ ë„¤ ê·€í‰ì´ì™€ ì¤‘ì•™ T-ì¡´ìœ¼ë¡œ ë¹ ë¥´ê²Œ ì´ë™í•˜ë©° ëŸ°ì§€ ìì„¸ë¡œ ê°€ìƒì˜ ê³µì„ ì¹˜ëŠ” ë™ì‘ì„ ì—°ìŠµí•©ë‹ˆë‹¤.',
                                        targetMuscles: 'ì „ì‹  (ê²½ê¸° íŠ¹í™”)',
                                        safetyTip: 'ì¶©ë¶„í•œ ê³µê°„ì„ í™•ë³´í•˜ê³  ë¯¸ë„ëŸ¬ì§€ì§€ ì•ŠëŠ” ì‹ ë°œì„ ì°©ìš©í•˜ì„¸ìš”.'
                                    }
                                ]
                            }
                        ]
                    },
                    cooldown: {
                        id: 'cooldown',
                        title: 'ê²½ê¸° í›„ ì¿¨ë‹¤ìš´ (ì •ì  ìŠ¤íŠ¸ë ˆì¹­)',
                        description: 'ê·¼ìœ¡ ì´ì™„ ë° íšŒë³µ ì´‰ì§„ì„ ìœ„í•œ ì²´ê³„ì  ì •ë¦¬ìš´ë™',
                        color: '#3b82f6',
                        totalTime: 15, // minutes
                        phases: [
                            {
                                name: '1ë‹¨ê³„: ì ì§„ì  ì‹¬ë°•ìˆ˜ ê°ì†Œ',
                                description: 'ê²½ê¸° í›„ ì•ˆì „í•œ ì‹¬ë°•ìˆ˜ ì •ìƒí™”',
                                exercises: [
                                    {
                                        name: 'ì²œì²œíˆ ê±·ê¸°',
                                        duration: 180,
                                        instructions: 'ì½”íŠ¸ë¥¼ ì²œì²œíˆ ê±¸ìœ¼ë©° í˜¸í¡ì„ ì •ìƒí™”í•˜ê³  ì‹¬ë°•ìˆ˜ë¥¼ ì ì§„ì ìœ¼ë¡œ ë‚®ì¶¥ë‹ˆë‹¤. ê°‘ì‘ìŠ¤ëŸ½ê²Œ ë©ˆì¶”ì§€ ë§ˆì„¸ìš”.',
                                        targetMuscles: 'ì‹¬íê¸°ëŠ¥ ì •ìƒí™”',
                                        safetyTip: 'ì–´ì§€ëŸ¬ì›€ì´ ëŠê»´ì§€ë©´ ì¦‰ì‹œ ì•‰ì•„ì„œ íœ´ì‹í•˜ì„¸ìš”.'
                                    }
                                ]
                            },
                            {
                                name: '2ë‹¨ê³„: ì£¼ìš” ê·¼ìœ¡êµ° ì •ì  ìŠ¤íŠ¸ë ˆì¹­',
                                description: 'ê²½ê¸°ë¡œ ê¸´ì¥ëœ ê·¼ìœ¡ì˜ ì´ì™„ ë° íšŒë³µ',
                                exercises: [
                                    {
                                        name: 'í–„ìŠ¤íŠ¸ë§ ìŠ¤íŠ¸ë ˆì¹­',
                                        duration: 30,
                                        instructions: 'ë°”ë‹¥ì— ì•‰ì•„ ë‹¤ë¦¬ë¥¼ ê³§ê²Œ ë»—ê³  ìƒì²´ë¥¼ ì•ìœ¼ë¡œ ìˆ™ì´ê±°ë‚˜, ëˆ„ìš´ ìì„¸ì—ì„œ í•œìª½ ë‹¤ë¦¬ë¥¼ ê°€ìŠ´ìœ¼ë¡œ ë‹¹ê²¨ í—ˆë²…ì§€ ë’¤ìª½ì„ ëŠ˜ë¦½ë‹ˆë‹¤.',
                                        targetMuscles: 'í—ˆë²…ì§€ ë’¤ìª½',
                                        safetyTip: 'ë°˜ë™ì„ ì£¼ì§€ ë§ê³  ë¶€ë“œëŸ½ê²Œ ëŠ˜ë ¤ì£¼ì„¸ìš”. í†µì¦ì´ ì•„ë‹Œ ë‹¹ê¸°ëŠ” ëŠë‚Œì— ì§‘ì¤‘í•˜ì„¸ìš”.'
                                    },
                                    {
                                        name: 'ëŒ€í‡´ì‚¬ë‘ê·¼ ìŠ¤íŠ¸ë ˆì¹­',
                                        duration: 30,
                                        instructions: 'ì„  ìì„¸ì—ì„œ ë²½ì„ ì§šê³  í•œìª½ ë‹¤ë¦¬ë¥¼ ë’¤ë¡œ êµ¬ë¶€ë ¤ ì†ìœ¼ë¡œ ì¡ê³ , ë°œë’¤ê¿ˆì¹˜ë¥¼ ì—‰ë©ì´ ìª½ìœ¼ë¡œ ë¶€ë“œëŸ½ê²Œ ë‹¹ê¹ë‹ˆë‹¤.',
                                        targetMuscles: 'í—ˆë²…ì§€ ì•ìª½',
                                        safetyTip: 'ë¬´ë¦ì´ ë°”ê¹¥ìª½ìœ¼ë¡œ ë²Œì–´ì§€ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ê³ , í—ˆë¦¬ê°€ ê³¼ë„í•˜ê²Œ êº¾ì´ì§€ ì•Šê²Œ í•˜ì„¸ìš”.'
                                    },
                                    {
                                        name: 'ì¥ìš”ê·¼ ìŠ¤íŠ¸ë ˆì¹­',
                                        duration: 30,
                                        instructions: 'ëŸ°ì§€ ìì„¸ì—ì„œ ë’¤ìª½ ë¬´ë¦ì„ ë°”ë‹¥ì— ëŒ€ê³ , ê³¨ë°˜ì„ ì•ìœ¼ë¡œ ë¶€ë“œëŸ½ê²Œ ë°€ì–´ í—ˆë²…ì§€ ì•ìª½ê³¼ ê³¨ë°˜ ì•ìª½ì„ ëŠ˜ë¦½ë‹ˆë‹¤.',
                                        targetMuscles: 'ì—‰ë©ì´ êµ´ê³¡ê·¼, ê³¨ë°˜',
                                        safetyTip: 'í—ˆë¦¬ê°€ ê³¼ë„í•˜ê²Œ êº¾ì´ì§€ ì•Šë„ë¡ ë³µë¶€ì— ì‚´ì§ í˜ì„ ì£¼ì„¸ìš”.'
                                    },
                                    {
                                        name: 'ì¢…ì•„ë¦¬ ìŠ¤íŠ¸ë ˆì¹­',
                                        duration: 30,
                                        instructions: 'ë²½ì„ ì§šê³  í•œ ë°œì„ ë’¤ë¡œ ë»—ì–´ ë°œë’¤ê¿ˆì¹˜ë¥¼ ë°”ë‹¥ì— ì§€ê·¸ì‹œ ëˆ„ë¥´ë©° ì¢…ì•„ë¦¬ ê·¼ìœ¡ì„ ëŠ˜ë¦½ë‹ˆë‹¤.',
                                        targetMuscles: 'ì¢…ì•„ë¦¬',
                                        safetyTip: 'ë°œë’¤ê¿ˆì¹˜ê°€ ë°”ë‹¥ì—ì„œ ë–¨ì–´ì§€ì§€ ì•Šë„ë¡ ìœ ì§€í•˜ì„¸ìš”.'
                                    },
                                    {
                                        name: 'ë‘”ê·¼ ìŠ¤íŠ¸ë ˆì¹­',
                                        duration: 30,
                                        instructions: 'ë°”ë‹¥ì— ì•‰ì•„ í•œìª½ ë‹¤ë¦¬ë¥¼ ë°˜ëŒ€ìª½ ë¬´ë¦ ìœ„ì— ì˜¬ë¦¬ê³ , ìƒì²´ë¥¼ ì•ìœ¼ë¡œ ìˆ™ì—¬ ì—‰ë©ì´ ê·¼ìœ¡ì„ ëŠ˜ë¦½ë‹ˆë‹¤.',
                                        targetMuscles: 'ì—‰ë©ì´',
                                        safetyTip: 'í—ˆë¦¬ë¥¼ êµ¬ë¶€ë¦¬ì§€ ë§ê³  ê³¨ë°˜ì—ì„œ ì•ìœ¼ë¡œ ìˆ™ì´ì„¸ìš”.'
                                    },
                                    {
                                        name: 'ì–´ê¹¨ & ì‚¼ë‘ê·¼ ìŠ¤íŠ¸ë ˆì¹­',
                                        duration: 30,
                                        instructions: 'í•œìª½ íŒ”ì„ ê°€ìŠ´ ì•ìœ¼ë¡œ êµì°¨ì‹œì¼œ ë‹¤ë¥¸ íŒ”ë¡œ ì§€íƒ±í•˜ê±°ë‚˜, íŒ”ê¿ˆì¹˜ë¥¼ êµ¬ë¶€ë ¤ ë¨¸ë¦¬ ë’¤ë¡œ ë„˜ê²¨ ì‚¼ë‘ê·¼ì„ ëŠ˜ë¦½ë‹ˆë‹¤.',
                                        targetMuscles: 'ì–´ê¹¨, ì‚¼ë‘ê·¼',
                                        safetyTip: 'ëª©ì— ë¬´ë¦¬ê°€ ê°€ì§€ ì•Šë„ë¡ ë¶€ë“œëŸ½ê²Œ ì§„í–‰í•˜ì„¸ìš”.'
                                    }
                                ]
                            }
                        ]
                    }
                };
                
                this.init();
            }
            
            init() {
                if (this.state.userProfile.age) {
                    this.state.currentScreen = 'main';
                }
                this.render();
                this.setupEventListeners();
            }
            
            loadProfile() {
                try {
                    return JSON.parse(localStorage.getItem('userProfile')) || { age: '', experience: '', injuries: [] };
                } catch (e) {
                    return { age: '', experience: '', injuries: [] };
                }
            }
            
            saveProfile() {
                localStorage.setItem('userProfile', JSON.stringify(this.state.userProfile));
            }
            
            loadProgress() {
                try {
                    return JSON.parse(localStorage.getItem('sessionProgress')) || [];
                } catch (e) {
                    return [];
                }
            }
            
            saveProgress() {
                localStorage.setItem('sessionProgress', JSON.stringify(this.state.sessionProgress));
            }
            
            setupEventListeners() {
                // í„°ì¹˜ì™€ í´ë¦­ ì´ë²¤íŠ¸ ëª¨ë‘ ì²˜ë¦¬
                const handleInteraction = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    let target = e.target;
                    while (target && !target.matches('[data-action]') && target !== document.body) {
                        target = target.parentElement;
                    }
                    
                    if (target && target.matches('[data-action]')) {
                        const action = target.dataset.action;
                        const value = target.dataset.value;
                        this.handleAction(action, value, target);
                    }
                };
                
                // í´ë¦­ê³¼ í„°ì¹˜ ì´ë²¤íŠ¸ ëª¨ë‘ ë°”ì¸ë”©
                document.addEventListener('click', handleInteraction, { passive: false });
                document.addEventListener('touchend', handleInteraction, { passive: false });
                
                // í¼ ì´ë²¤íŠ¸ ì²˜ë¦¬
                document.addEventListener('change', (e) => {
                    if (e.target.matches('[data-profile]')) {
                        const field = e.target.dataset.profile;
                        this.updateProfile(field, e.target.value);
                    }
                });
                
                // ë”ë¸”íƒ­ í™•ëŒ€ ë°©ì§€
                let lastTouchEnd = 0;
                document.addEventListener('touchend', (e) => {
                    const now = Date.now();
                    if (now - lastTouchEnd <= 300) {
                        e.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);
            }
            
            handleAction(action, value, element) {
                console.log('Action triggered:', action, value); // ë””ë²„ê¹…ìš©
                
                switch (action) {
                    case 'start-routine':
                        this.startRoutine(value);
                        break;
                    case 'next-exercise':
                        this.nextExercise();
                        break;
                    case 'prev-exercise':
                        this.prevExercise();
                        break;
                    case 'toggle-timer':
                        this.toggleTimer();
                        break;
                    case 'complete-profile':
                        this.completeProfile();
                        break;
                    case 'toggle-injury':
                        this.toggleInjury(value);
                        break;
                    case 'navigate':
                        this.navigate(value);
                        break;
                    case 'reset-profile':
                        this.resetProfile();
                        break;
                }
            }
            
            updateProfile(field, value) {
                this.state.userProfile[field] = value;
                this.render();
            }
            
            toggleInjury(injury) {
                const injuries = this.state.userProfile.injuries;
                
                if (injury === 'ì—†ìŒ') {
                    if (injuries.includes('ì—†ìŒ')) {
                        this.state.userProfile.injuries = [];
                    } else {
                        this.state.userProfile.injuries = ['ì—†ìŒ'];
                    }
                } else {
                    if (injuries.includes(injury)) {
                        this.state.userProfile.injuries = injuries.filter(i => i !== injury);
                    } else {
                        this.state.userProfile.injuries = injuries.filter(i => i !== 'ì—†ìŒ').concat(injury);
                    }
                }
                
                this.render();
            }
            
            completeProfile() {
                const { age, experience, injuries } = this.state.userProfile;
                if (age && experience && injuries.length > 0) {
                    this.saveProfile();
                    this.navigate('main');
                }
            }
            
            resetProfile() {
                if (confirm('í”„ë¡œí•„ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    this.state.userProfile = { age: '', experience: '', injuries: [] };
                    localStorage.removeItem('userProfile');
                    this.navigate('welcome');
                }
            }
            
            startRoutine(routineId) {
                this.state.currentRoutine = this.routines[routineId];
                this.state.currentPhase = 0;
                this.state.currentExercise = 0;
                this.state.timeRemaining = this.getCurrentExercise().duration;
                this.state.isRunning = false;
                this.navigate('exercise');
            }
            
            getCurrentExercise() {
                return this.state.currentRoutine.phases[this.state.currentPhase].exercises[this.state.currentExercise];
            }
            
            nextExercise() {
                const phase = this.state.currentRoutine.phases[this.state.currentPhase];
                
                if (this.state.currentExercise < phase.exercises.length - 1) {
                    this.state.currentExercise++;
                } else if (this.state.currentPhase < this.state.currentRoutine.phases.length - 1) {
                    this.state.currentPhase++;
                    this.state.currentExercise = 0;
                } else {
                    // Routine completed
                    this.completeRoutine();
                    return;
                }
                
                this.state.timeRemaining = this.getCurrentExercise().duration;
                this.state.isRunning = false;
                this.render();
            }
            
            prevExercise() {
                if (this.state.currentExercise > 0) {
                    this.state.currentExercise--;
                } else if (this.state.currentPhase > 0) {
                    this.state.currentPhase--;
                    const phase = this.state.currentRoutine.phases[this.state.currentPhase];
                    this.state.currentExercise = phase.exercises.length - 1;
                }
                
                this.state.timeRemaining = this.getCurrentExercise().duration;
                this.state.isRunning = false;
                this.render();
            }
            
            toggleTimer() {
                this.state.isRunning = !this.state.isRunning;
                
                if (this.state.isRunning) {
                    this.state.timerInterval = setInterval(() => {
                        this.state.timeRemaining--;
                        this.updateTimerDisplay();
                        
                        if (this.state.timeRemaining <= 0) {
                            this.state.isRunning = false;
                            clearInterval(this.state.timerInterval);
                            this.render();
                            this.playSound();
                        }
                    }, 1000);
                } else {
                    clearInterval(this.state.timerInterval);
                }
                
                this.render();
            }
            
            completeRoutine() {
                const session = {
                    routine: this.state.currentRoutine.title,
                    date: new Date().toISOString(),
                    duration: this.state.currentRoutine.totalTime
                };
                
                this.state.sessionProgress.push(session);
                this.saveProgress();
                this.navigate('completion');
            }
            
            navigate(screen) {
                this.state.currentScreen = screen;
                this.render();
            }
            
            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            
            updateTimerDisplay() {
                const timerEl = document.querySelector('.timer-display');
                if (timerEl) {
                    timerEl.textContent = this.formatTime(this.state.timeRemaining);
                }
            }
            
            playSound() {
                // Create a simple beep sound
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                } catch (e) {
                    // Fallback for browsers that don't support Web Audio API
                    console.log('Timer finished!');
                    
                    // ëŒ€ì•ˆ: ì§„ë™ (ëª¨ë°”ì¼ì—ì„œ ì§€ì›ë˜ëŠ” ê²½ìš°)
                    if ('vibrate' in navigator) {
                        navigator.vibrate([200, 100, 200]);
                    }
                }
            }
            
            getProgressPercentage() {
                const totalExercises = this.state.currentRoutine.phases.reduce((total, phase) => total + phase.exercises.length, 0);
                const completedExercises = this.state.currentRoutine.phases.slice(0, this.state.currentPhase).reduce((total, phase) => total + phase.exercises.length, 0) + this.state.currentExercise;
                return Math.round((completedExercises / totalExercises) * 100);
            }
            
            render() {
                const content = document.getElementById('app-content');
                content.innerHTML = this.getScreenHTML();
                content.className = 'fade-in';
            }
            
            getScreenHTML() {
                switch (this.state.currentScreen) {
                    case 'welcome':
                        return this.renderWelcomeScreen();
                    case 'main':
                        return this.renderMainScreen();
                    case 'exercise':
                        return this.renderExerciseScreen();
                    case 'completion':
                        return this.renderCompletionScreen();
                    case 'education':
                        return this.renderEducationScreen();
                    case 'progress':
                        return this.renderProgressScreen();
                    default:
                        return this.renderWelcomeScreen();
                }
            }
            
            renderWelcomeScreen() {
                const { age, experience, injuries } = this.state.userProfile;
                const isComplete = age && experience && injuries.length > 0;
                
                return `
                    <div class="header">
                        <h1>ğŸ¾ ìŠ¤ì¿¼ì‹œ ìŠ¤íŠ¸ë ˆì¹­ í”„ë¡œ</h1>
                        <p>ì•ˆì „í•˜ê³  ê³¼í•™ì ì¸ ì£¼ë‹ˆì–´ ì „ìš© ê°€ì´ë“œ</p>
                    </div>
                    <div class="content profile-setup">
                        <div class="form-group">
                            <label class="form-label">ë‚˜ì´ <span style="color: #ef4444">*</span></label>
                            <select class="form-select" data-profile="age">
                                <option value="">ë‚˜ì´ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="8-9" ${age === '8-9' ? 'selected' : ''}>8-9ì„¸</option>
                                <option value="10-12" ${age === '10-12' ? 'selected' : ''}>10-12ì„¸</option>
                                <option value="13-15" ${age === '13-15' ? 'selected' : ''}>13-15ì„¸</option>
                                <option value="16-18" ${age === '16-18' ? 'selected' : ''}>16-18ì„¸</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ìŠ¤ì¿¼ì‹œ ê²½í—˜ <span style="color: #ef4444">*</span></label>
                            <select class="form-select" data-profile="experience">
                                <option value="">ê²½í—˜ ìˆ˜ì¤€ì„ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="beginner" ${experience === 'beginner' ? 'selected' : ''}>ì´ˆê¸‰ (1ë…„ ë¯¸ë§Œ)</option>
                                <option value="intermediate" ${experience === 'intermediate' ? 'selected' : ''}>ì¤‘ê¸‰ (1-3ë…„)</option>
                                <option value="advanced" ${experience === 'advanced' ? 'selected' : ''}>ê³ ê¸‰ (3ë…„ ì´ìƒ)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">í˜„ì¬ ë¶€ìƒì´ë‚˜ í†µì¦ ë¶€ìœ„ <span style="color: #ef4444">*</span></label>
                            <div class="checkbox-group">
                                ${['ë¬´ë¦', 'ë°œëª©', 'í—ˆë¦¬', 'ì–´ê¹¨', 'ì†ëª©', 'ì—†ìŒ'].map(injury => `
                                    <div class="checkbox-item ${injuries.includes(injury) ? 'selected' : ''}" data-action="toggle-injury" data-value="${injury}">
                                        <div class="checkbox ${injuries.includes(injury) ? 'checked' : ''}">
                                            ${injuries.includes(injury) ? 'âœ“' : ''}
                                        </div>
                                        <span>${injury}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" data-action="complete-profile" ${!isComplete ? 'disabled' : ''}>
                            ${isComplete ? 'í”„ë¡œí•„ ì™„ë£Œí•˜ê¸°' : 'ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'}
                        </button>
                        
                        <div class="safety-tip" style="margin-top: 20px;">
                            <strong>ì£¼ë‹ˆì–´ ì„ ìˆ˜ ì•ˆì „ ìˆ˜ì¹™:</strong><br>
                            ì„±ì¥ê¸° ì„ ìˆ˜ì˜ ì•ˆì „ì„ ìœ„í•´ í†µì¦ì´ ëŠê»´ì§€ë©´ ì¦‰ì‹œ ì¤‘ë‹¨í•˜ê³ , ê³¼ë„í•œ ìŠ¤íŠ¸ë ˆì¹­ì€ í”¼í•´ì£¼ì„¸ìš”. ì„±ì¥íŒ ë³´í˜¸ê°€ ê°€ì¥ ì¤‘ìš”í•©ë‹ˆë‹¤.
                            ${age === '8-9' ? '<br><br><strong>âš ï¸ 8-9ì„¸ íŠ¹ë³„ ì£¼ì˜:</strong> ë”ìš± ë¶€ë“œëŸ½ê³  ì§§ì€ ì‹œê°„ìœ¼ë¡œ ì§„í–‰í•˜ë©°, ë°˜ë“œì‹œ ë³´í˜¸ì ì§€ë„í•˜ì— ì‹¤ì‹œí•˜ì„¸ìš”.' : ''}
                        </div>
                    </div>
                `;
            }
            
            renderMainScreen() {
                const { age, experience } = this.state.userProfile;
                const totalSessions = this.state.sessionProgress.length;
                const warmupSessions = this.state.sessionProgress.filter(s => s.routine.includes('ì›œì—…')).length;
                
                return `
                    <div class="header">
                        <h1>ğŸ¾ ìŠ¤ì¿¼ì‹œ ìŠ¤íŠ¸ë ˆì¹­ í”„ë¡œ</h1>
                        <p>ì•ˆì „í•˜ê³  ê³¼í•™ì ì¸ ìŠ¤íŠ¸ë ˆì¹­ìœ¼ë¡œ ê²½ê¸°ë ¥ í–¥ìƒ</p>
                        <div style="margin-top: 12px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                            <span style="background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 12px;">
                                ${age} â€¢ ${experience === 'beginner' ? 'ì´ˆê¸‰' : experience === 'intermediate' ? 'ì¤‘ê¸‰' : 'ê³ ê¸‰'}
                            </span>
                            <button style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 4px 8px; border-radius: 50%; cursor: pointer; touch-action: manipulation;" data-action="reset-profile" title="í”„ë¡œí•„ ì´ˆê¸°í™”">âš™ï¸</button>
                        </div>
                    </div>
                    <div class="content">
                        <div class="grid" style="gap: 16px;">
                            <button class="btn btn-primary" data-action="start-routine" data-value="warmup">
                                <div style="text-align: left;">
                                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 4px;">ğŸ”¥ ê²½ê¸° ì „ ì›œì—…</div>
                                    <div style="font-size: 14px; opacity: 0.9;">ë™ì  ìŠ¤íŠ¸ë ˆì¹­ â€¢ 15-20ë¶„</div>
                                    <div style="font-size: 12px; opacity: 0.8;">3ë‹¨ê³„ ê³¼í•™ì  ì¤€ë¹„ìš´ë™</div>
                                </div>
                            </button>
                            
                            <button class="btn btn-secondary" data-action="start-routine" data-value="cooldown">
                                <div style="text-align: left;">
                                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 4px;">â„ï¸ ê²½ê¸° í›„ ì¿¨ë‹¤ìš´</div>
                                    <div style="font-size: 14px; opacity: 0.9;">ì •ì  ìŠ¤íŠ¸ë ˆì¹­ â€¢ 15-20ë¶„</div>
                                    <div style="font-size: 12px; opacity: 0.8;">ê·¼ìœ¡ ì´ì™„ ë° íšŒë³µ ì´‰ì§„</div>
                                </div>
                            </button>
                        </div>
                        
                        <div class="stats-grid" style="margin: 24px 0;">
                            <div class="stat-card">
                                <div class="stat-value">${totalSessions}</div>
                                <div class="stat-label">ì™„ë£Œ ì„¸ì…˜</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${warmupSessions}</div>
                                <div class="stat-label">ì›œì—… ì„¸ì…˜</div>
                            </div>
                        </div>
                        
                        <div class="grid grid-2" style="gap: 12px;">
                            <button class="btn btn-outline" data-action="navigate" data-value="education">
                                <div style="text-align: center;">
                                    <div style="font-size: 24px; margin-bottom: 8px;">ğŸ“š</div>
                                    <div style="font-size: 14px; font-weight: 600;">êµìœ¡ ì„¼í„°</div>
                                </div>
                            </button>
                            
                            <button class="btn btn-outline" data-action="navigate" data-value="progress">
                                <div style="text-align: center;">
                                    <div style="font-size: 24px; margin-bottom: 8px;">ğŸ“Š</div>
                                    <div style="font-size: 14px; font-weight: 600;">ì§„í–‰ ìƒí™©</div>
                                </div>
                            </button>
                        </div>
                    </div>
                `;
            }
            
            renderExerciseScreen() {
                const exercise = this.getCurrentExercise();
                const phase = this.state.currentRoutine.phases[this.state.currentPhase];
                const progress = this.getProgressPercentage();
                const isFirstExercise = this.state.currentPhase === 0 && this.state.currentExercise === 0;
                
                return `
                    <div class="header">
                        <h1>${this.state.currentRoutine.title}</h1>
                        <p>${phase.name}</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <div style="font-size: 12px; opacity: 0.9; margin-top: 8px;">
                            ì§„í–‰ë¥ : ${progress}%
                        </div>
                    </div>
                    <div class="content">
                        <div class="exercise-card">
                            <div class="exercise-title">${exercise.name}</div>
                            <div class="exercise-info">
                                <strong>ëŒ€ìƒ ê·¼ìœ¡:</strong> ${exercise.targetMuscles}
                                ${exercise.reps ? `<br><strong>ë°˜ë³µ íšŸìˆ˜:</strong> ${exercise.reps}` : ''}
                            </div>
                            
                            <div class="timer ${this.state.isRunning ? 'running' : ''}">
                                <div class="timer-display">${this.formatTime(this.state.timeRemaining)}</div>
                            </div>
                            
                            <div class="exercise-instructions">
                                <strong>ë™ì‘ ë°©ë²•:</strong><br>
                                ${exercise.instructions}
                            </div>
                            
                            ${exercise.safetyTip ? `
                                <div class="safety-tip">
                                    <strong>ì•ˆì „ ìˆ˜ì¹™:</strong> ${exercise.safetyTip}
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="controls">
                            <button class="btn-control btn-skip" data-action="prev-exercise" ${isFirstExercise ? 'disabled' : ''}>
                                â®ï¸ ì´ì „
                            </button>
                            <button class="btn-control btn-play" data-action="toggle-timer">
                                ${this.state.isRunning ? 'â¸ï¸ ì¼ì‹œì •ì§€' : 'â–¶ï¸ ì‹œì‘'}
                            </button>
                            <button class="btn-control btn-skip" data-action="next-exercise">
                                ë‹¤ìŒ â­ï¸
                            </button>
                        </div>
                        
                        <button class="btn btn-outline" data-action="navigate" data-value="main" style="margin-top: 16px;">
                            ğŸ  ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                        </button>
                    </div>
                `;
            }
            
            renderCompletionScreen() {
                return `
                    <div class="completion-screen">
                        <span class="completion-icon">ğŸ‰</span>
                        <h1 style="font-size: 28px; font-weight: 700; color: #1f2937; margin-bottom: 16px;">ìš´ë™ ì™„ë£Œ!</h1>
                        <p style="color: #6b7280; margin-bottom: 32px;">í›Œë¥­í•©ë‹ˆë‹¤! ëª¨ë“  ìŠ¤íŠ¸ë ˆì¹­ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.</p>
                        
                        <div style="background: #f0fdf4; border: 2px solid #10b981; border-radius: 16px; padding: 20px; margin-bottom: 24px;">
                            <h3 style="color: #065f46; font-weight: 700; margin-bottom: 8px;">ì™„ë£Œí•œ ìš´ë™</h3>
                            <p style="color: #047857; font-weight: 600;">${this.state.currentRoutine.title}</p>
                            <p style="color: #059669; font-size: 14px;">${new Date().toLocaleDateString('ko-KR')} ì™„ë£Œ</p>
                        </div>
                        
                        <div class="grid grid-2" style="gap: 16px; margin-bottom: 24px;">
                            <button class="btn btn-primary" data-action="navigate" data-value="main">
                                ğŸ  ë©”ì¸ í™”ë©´
                            </button>
                            <button class="btn btn-outline" data-action="navigate" data-value="progress">
                                ğŸ“Š ì§„í–‰ ìƒí™©
                            </button>
                        </div>
                        
                        <div style="background: #eff6ff; border: 2px solid #3b82f6; border-radius: 12px; padding: 16px; font-size: 14px; color: #1e40af;">
                            <strong>ğŸ’¡ ìš´ë™ í›„ íŒ:</strong><br>
                            ì¶©ë¶„í•œ ìˆ˜ë¶„ ì„­ì·¨ì™€ ì ì ˆí•œ íœ´ì‹ì„ ì·¨í•˜ì„¸ìš”. ëª¸ì˜ ë³€í™”ë¥¼ ì£¼ì˜ê¹Šê²Œ ê´€ì°°í•˜ê³ , ì´ìƒì´ ìˆìœ¼ë©´ ì¦‰ì‹œ íœ´ì‹í•˜ì„¸ìš”.
                        </div>
                    </div>
                `;
            }
            
            renderEducationScreen() {
                return `
                    <div class="header">
                        <h1>ğŸ“š êµìœ¡ ì„¼í„°</h1>
                        <p>ì˜¬ë°”ë¥¸ ìŠ¤íŠ¸ë ˆì¹­ ë°©ë²•ì„ ë°°ì›Œë³´ì„¸ìš”</p>
                    </div>
                    <div class="content">
                        <div class="education-content">
                            <div class="education-card">
                                <h3>ğŸ”„ ë™ì  vs ì •ì  ìŠ¤íŠ¸ë ˆì¹­</h3>
                                <p><strong>ë™ì  ìŠ¤íŠ¸ë ˆì¹­:</strong> ê²½ê¸° ì „ì— ì‹¤ì‹œí•˜ë©°, ì›€ì§ì´ë©´ì„œ ê·¼ìœ¡ì„ ì˜ˆì—´í•©ë‹ˆë‹¤. í˜ˆì•¡ìˆœí™˜ì„ ì´‰ì§„í•˜ê³  ì‹ ê²½ê³„ë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤.</p>
                                <p><strong>ì •ì  ìŠ¤íŠ¸ë ˆì¹­:</strong> ê²½ê¸° í›„ì— ì‹¤ì‹œí•˜ë©°, ê·¼ìœ¡ì„ ì´ì™„ì‹œì¼œ íšŒë³µì„ ë•ìŠµë‹ˆë‹¤. ì –ì‚° ì œê±°ì™€ ê·¼ìœ¡í†µ ì˜ˆë°©ì— íš¨ê³¼ì ì…ë‹ˆë‹¤.</p>
                            </div>
                            
                            <div class="education-card" style="background: #fef3c7; border-color: #f59e0b;">
                                <h3 style="color: #92400e;">âš ï¸ ì£¼ë‹ˆì–´ ì„ ìˆ˜ íŠ¹ë³„ ì£¼ì˜ì‚¬í•­</h3>
                                <ul style="color: #92400e;">
                                    <li>ì„±ì¥íŒ ë³´í˜¸ë¥¼ ìœ„í•´ ê³¼ë„í•œ ìŠ¤íŠ¸ë ˆì¹­ ê¸ˆì§€</li>
                                    <li>í†µì¦ì´ ì•„ë‹Œ 'ë‹¹ê¸°ëŠ”' ëŠë‚Œì—ì„œ ë©ˆì¶”ê¸°</li>
                                    <li>ë°˜ë™ì„ ì´ìš©í•œ ìŠ¤íŠ¸ë ˆì¹­ ì ˆëŒ€ ê¸ˆì§€</li>
                                    <li>ì¶©ë¶„í•œ ìˆ˜ë¶„ ì„­ì·¨ ë° íœ´ì‹</li>
                                    <li>ì ì§„ì ì¸ í›ˆë ¨ ê°•ë„ ì¦ê°€</li>
                                </ul>
                            </div>
                            
                            <div class="education-card" style="background: #eff6ff; border-color: #3b82f6;">
                                <h3 style="color: #1e40af;">ğŸ¾ ìŠ¤ì¿¼ì‹œ ë¶€ìƒ ì˜ˆë°©</h3>
                                <ul style="color: #1e40af;">
                                    <li>ê²½ê¸° ì „ ë°˜ë“œì‹œ ì¶©ë¶„í•œ ì›œì—… (15-20ë¶„)</li>
                                    <li>ì˜¬ë°”ë¥¸ ì‹ ë°œ ì°©ìš© (ë…¼ìŠ¬ë¦½ ìŠ¤ì¿¼ì‹œí™”)</li>
                                    <li>ì •ê¸°ì ì¸ ê·¼ë ¥ ìš´ë™ ë³‘í–‰</li>
                                    <li>ì ì ˆí•œ íœ´ì‹ê³¼ íšŒë³µ ì‹œê°„ í™•ë³´</li>
                                    <li>ì˜¬ë°”ë¥¸ ìì„¸ì™€ ê¸°ìˆ  ìŠµë“</li>
                                </ul>
                            </div>
                            
                            <div class="education-card" style="background: #f0fdf4; border-color: #10b981;">
                                <h3 style="color: #065f46;">ğŸ’ª ìŠ¤ì¿¼ì‹œ ì£¼ìš” ê·¼ìœ¡êµ°</h3>
                                <p style="color: #047857;"><strong>í•˜ì²´:</strong> ëŒ€í‡´ì‚¬ë‘ê·¼, í–„ìŠ¤íŠ¸ë§, ë‘”ê·¼, ì¢…ì•„ë¦¬ - ëŸ°ì§€ì™€ ë¹ ë¥¸ ì´ë™ì„ ìœ„í•´ ì¤‘ìš”</p>
                                <p style="color: #047857;"><strong>ìƒì²´:</strong> ì–´ê¹¨, ì‚¼ë‘ê·¼, ë“± - ê°•ë ¥í•œ ìŠ¤ìœ™ì„ ìœ„í•´ í•„ìš”</p>
                                <p style="color: #047857;"><strong>ì½”ì–´:</strong> ë³µë¶€, í—ˆë¦¬ - ëª¸í†µ íšŒì „ê³¼ ì•ˆì •ì„±ì„ ìœ„í•´ í•µì‹¬</p>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" data-action="navigate" data-value="main" style="margin-top: 20px;">
                            ğŸ  ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                        </button>
                    </div>
                `;
            }
            
            renderProgressScreen() {
                const totalSessions = this.state.sessionProgress.length;
                const warmupSessions = this.state.sessionProgress.filter(s => s.routine.includes('ì›œì—…')).length;
                const cooldownSessions = this.state.sessionProgress.filter(s => s.routine.includes('ì¿¨ë‹¤ìš´')).length;
                const recentSessions = this.state.sessionProgress.slice(-5).reverse();
                
                return `
                    <div class="header">
                        <h1>ğŸ“Š ì§„í–‰ ìƒí™©</h1>
                        <p>ë‹¹ì‹ ì˜ ìŠ¤íŠ¸ë ˆì¹­ ê¸°ë¡ì„ í™•ì¸í•˜ì„¸ìš”</p>
                    </div>
                    <div class="content">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value">${totalSessions}</div>
                                <div class="stat-label">ì´ ì™„ë£Œ ì„¸ì…˜</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${warmupSessions}</div>
                                <div class="stat-label">ì›œì—… ì„¸ì…˜</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${cooldownSessions}</div>
                                <div class="stat-label">ì¿¨ë‹¤ìš´ ì„¸ì…˜</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${Math.round(this.state.sessionProgress.reduce((total, s) => total + (s.duration || 0), 0) / 60)}</div>
                                <div class="stat-label">ì´ ìš´ë™ ì‹œê°„ (ì‹œê°„)</div>
                            </div>
                        </div>
                        
                        <h3 style="font-weight: 700; color: #1f2937; margin: 24px 0 16px 0;">ìµœê·¼ í™œë™</h3>
                        
                        ${totalSessions === 0 ? `
                            <div style="text-align: center; padding: 40px 20px; color: #6b7280;">
                                <div style="font-size: 48px; margin-bottom: 16px;">ğŸ¯</div>
                                <p>ì•„ì§ ì™„ë£Œí•œ ì„¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                                <p style="font-size: 14px; margin-top: 8px;">ì²« ë²ˆì§¸ ìŠ¤íŠ¸ë ˆì¹­ ë£¨í‹´ì„ ì‹œì‘í•´ë³´ì„¸ìš”!</p>
                            </div>
                        ` : `
                            <div style="space-y: 12px;">
                                ${recentSessions.map(session => `
                                    <div style="background: white; border: 2px solid #e5e7eb; border-radius: 12px; padding: 16px; margin-bottom: 12px;">
                                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                            <div>
                                                <div style="font-weight: 600; color: #1f2937; margin-bottom: 4px;">
                                                    ${session.routine.includes('ì›œì—…') ? 'ğŸ”¥' : 'â„ï¸'} ${session.routine}
                                                </div>
                                                <div style="font-size: 12px; color: #6b7280;">
                                                    ${session.duration ? `${session.duration}ë¶„` : 'ì™„ë£Œ'}
                                                </div>
                                            </div>
                                            <div style="font-size: 12px; color: #6b7280; text-align: right;">
                                                ${new Date(session.date).toLocaleDateString('ko-KR')}<br>
                                                ${new Date(session.date).toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' })}
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            
                            ${totalSessions >= 5 ? `
                                <div style="background: #f0fdf4; border: 2px solid #10b981; border-radius: 12px; padding: 16px; margin-top: 20px; text-align: center;">
                                    <div style="font-size: 24px; margin-bottom: 8px;">ğŸ†</div>
                                    <div style="font-weight: 700; color: #065f46; margin-bottom: 4px;">ê¾¸ì¤€í•¨ì˜ ë‹¬ì¸!</div>
                                    <div style="font-size: 14px; color: #047857;">ì´ë¯¸ ${totalSessions}íšŒì˜ ì„¸ì…˜ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!</div>
                                </div>
                            ` : ''}
                        `}
                        
                        <button class="btn btn-primary" data-action="navigate" data-value="main" style="margin-top: 20px;">
                            ğŸ  ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                        </button>
                    </div>
                `;
            }
        }
        
        // PWA Installation
        let deferredPrompt;
        const installPrompt = document.getElementById('installPrompt');
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallPrompt();
        });
        
        function showInstallPrompt() {
            if (!localStorage.getItem('installDismissed')) {
                installPrompt.style.display = 'flex';
            }
        }
        
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('App installed');
                    }
                    deferredPrompt = null;
                    installPrompt.style.display = 'none';
                });
            }
        }
        
        function dismissInstall() {
            installPrompt.style.display = 'none';
            localStorage.setItem('installDismissed', 'true');
        }
        
        // Network status
        function updateNetworkStatus() {
            const offlineBanner = document.getElementById('offlineBanner');
            if (navigator.onLine) {
                offlineBanner.style.display = 'none';
            } else {
                offlineBanner.style.display = 'block';
            }
        }
        
        window.addEventListener('online', updateNetworkStatus);
        window.addEventListener('offline', updateNetworkStatus);
        updateNetworkStatus();
        
        // Service Worker Registration
        if ('serviceWorker' in navigator && window.location.protocol === 'https:') {
            const swCode = `
                const CACHE_NAME = 'squash-stretching-v1.1';
                const OFFLINE_FALLBACK = '/index.html';
                
                self.addEventListener('install', event => {
                    console.log('Service Worker installing...');
                    event.waitUntil(
                        caches.open(CACHE_NAME).then(cache => {
                            console.log('Caching app shell');
                            return cache.addAll([
                                '/',
                                '/index.html',
                                'https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap'
                            ]).catch(err => {
                                console.log('Cache failed for some resources:', err);
                                return Promise.resolve();
                            });
                        })
                    );
                    self.skipWaiting();
                });
                
                self.addEventListener('activate', event => {
                    console.log('Service Worker activating...');
                    event.waitUntil(
                        caches.keys().then(cacheNames => {
                            return Promise.all(
                                cacheNames.map(cacheName => {
                                    if (cacheName !== CACHE_NAME) {
                                        console.log('Deleting old cache:', cacheName);
                                        return caches.delete(cacheName);
                                    }
                                })
                            );
                        })
                    );
                    return self.clients.claim();
                });
                
                self.addEventListener('fetch', event => {
                    if (event.request.method !== 'GET') return;
                    
                    event.respondWith(
                        caches.match(event.request)
                            .then(response => {
                                if (response) {
                                    return response;
                                }
                                
                                return fetch(event.request).catch(() => {
                                    return caches.match(OFFLINE_FALLBACK);
                                });
                            })
                    );
                });
            `;
            
            try {
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(registration => {
                        console.log('âœ… Service Worker registered:', registration.scope);
                    })
                    .catch(error => {
                        console.warn('âŒ Service Worker registration failed:', error);
                    });
            } catch (error) {
                console.warn('âŒ Service Worker creation failed:', error);
            }
        }
        
        // Prevent default mobile behaviors
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault(); // Prevent zoom
            }
        }, { passive: false });
        
        // Prevent pull-to-refresh
        let startY = 0;
        document.addEventListener('touchstart', e => {
            startY = e.touches[0].pageY;
        });
        
        document.addEventListener('touchmove', e => {
            const y = e.touches[0].pageY;
            if (startY <= y && window.pageYOffset === 0) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // Initialize App
        const app = new StretchingApp();
        
        // Show install prompt after delay
        setTimeout(() => {
            if (!window.matchMedia('(display-mode: standalone)').matches && !localStorage.getItem('installDismissed')) {
                showInstallPrompt();
            }
        }, 5000);
    </script>
</body>
</html>
